# Java Code Analysis!?! #

## Overview ##

300 points

Category: [Web Exploitation](../)

Tags : `#Web Exploitation`

## Description ##

BookShelf Pico, my premium online book-reading service.
I believe that my website is super secure. I challenge you to prove me wrong by reading the 'Flag' book!

## Approach ##

Going to the website, we find a login page. The credentials are provided in the description of the challenge, being `user` and `user`. Once we are in, we see a "book" named flag. This is clearly the target. Going into developer tools > Application > Local Storage we find two entries. One is called `token-payload` and the other is called `auth-token`. Changing the token-payload from `Free` to something like `Admin` does change our role, but not our permissions. Going through the source code, we find a file inside `src\main\java\io\github\nandandesai\pico\security` called `SecretGenerator.java`. This reveals that the secret generated is hard coded with a value of `1234`. Knowing based on the hints that `auth-token` is a JWT web token, we can use a website such as [jwt.io](https://jwt.io/) to decipher the token. Putting the token from the value of `auth-token` inside, we see that in the payload there is a field called role. We can modify this to be `Admin`. When doing some expirimenting, userId field also has to be changed to `3`. We can then paste our secret, in this case being hard-coded `1234`. We can now paste this new token into the token field, and update `token-payload` to change our role to `Admin`. Once we refresh, we will find a new link when we click our profile picture, called `Admin Dashboard`. From here, we can simply change the role of the User user by clicking the edit button and selecting Admin. Now we have to log out and log back in, in which case you will notice that our role has been updated to Admin. We can now access the book and get the flag.

## Solution ##

The book that is accessed is in the following format (actual flag value redacted for the purposes of this write up):

```
Great job! Hereâ€™s your flag: 
picoCTF{........redacted........}

```
